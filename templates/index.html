{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <div class="card task-card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">üìÅ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞</h5>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    {{ single_form.hidden_tag() }}
                    
                    <div class="mb-3">
                        {{ single_form.file.label(class="form-label") }}
                        {{ single_form.file(class="form-control") }}
                        {% if single_form.file.errors %}
                            <div class="text-danger">
                                {% for error in single_form.file.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ single_form.model_size.label(class="form-label") }}
                        {{ single_form.model_size(class="form-select") }}
                    </div>

                    <div class="mb-3">
                        {{ single_form.language.label(class="form-label") }}
                        {{ single_form.language(class="form-select") }}
                    </div>

                    {{ single_form.submit(class="btn btn-success w-100") }}
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card task-card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">üìÇ –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">
                    –î–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫—É <code>uploads/</code> –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.
                </p>
                
                <form method="POST" action="{{ url_for('batch_process') }}">
                    {{ batch_form.hidden_tag() }}
                    
                    <div class="mb-3">
                        {{ batch_form.model_size.label(class="form-label") }}
                        {{ batch_form.model_size(class="form-select") }}
                    </div>

                    <div class="mb-3">
                        {{ batch_form.language.label(class="form-label") }}
                        {{ batch_form.language(class="form-select") }}
                    </div>

                    {{ batch_form.submit(class="btn btn-warning w-100") }}
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h5>
            </div>
            <div class="card-body">
                <div id="system-info">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">üìã –ò—Å—Ç–æ—Ä–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏</h5>
            </div>
            <div class="card-body">
                {% if processed_files %}
                    <div class="file-list">
                        {% for task in processed_files %}
                            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                                <div>
                                    <strong>{{ task.id }}</strong>
                                    <small class="text-muted">({{ task.files|length }} —Ñ–∞–π–ª–æ–≤)</small>
                                </div>
                                <a href="{{ url_for('results', task_id=task.id) }}" class="btn btn-sm btn-outline-primary">
                                    –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted">–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ
fetch('/system_info')
    .then(response => response.json())
    .then(data => {
        const gpuStatus = data.gpu_available ? 
            `<span class="badge bg-success">–î–æ—Å—Ç—É–ø–µ–Ω</span> ${data.gpu_info}` : 
            '<span class="badge bg-secondary">–ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω</span>';
        
        document.getElementById('system-info').innerHTML = `
            <p><strong>GPU:</strong> ${gpuStatus}</p>
            <p><strong>PyTorch –≤–µ—Ä—Å–∏—è:</strong> ${data.pytorch_version}</p>
            <p><strong>Whisper:</strong> <span class="badge bg-success">–î–æ—Å—Ç—É–ø–µ–Ω</span></p>
        `;
    })
    .catch(error => {
        document.getElementById('system-info').innerHTML = '<p class="text-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ</p>';
    });
</script>
{% endblock %}
